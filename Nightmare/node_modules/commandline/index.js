const discord = require("discord.js");
const config = require("../../config.json");
const configuration_module = require('bot_configuration');
const konachan_module = require('konachan');
const yandere_module = require('yandere');
const cat_module = require('cat');
const kick_module = require('kick');
const music = require('music');
const math = require('math');

module.exports.typed_command = function (message, bot) {
    console.log("-----------------------------------------");

    // Avoid bot to reply his own messages
    if (message.author.bot)
        return;

    // The bot will only read message beginning with the prefix
    if (!message.content.startsWith(config.prefix)) {
        return;
    }

    // Split the picked message after the prefix to get the command
    let command = message.content.split(" ")[0];
    command = command.slice(config.prefix.length);
    console.log("commande " + command);

    // Pick whatever is after the command to get specific parameters
    let args = message.content.split(" ").slice(1);
    console.log("args " + args);

    // Allows greetings configuration
    if (command === "set_hello") {
        configuration_module.set_hello(args, config, message);
    }

    // Allows obsenity level configuration for !konachan and !yandere
    if (command === "set_safe") {
        configuration_module.set_safe(args, config, message);
    }

    // Display a random picture from Konachan.com
    if (command === "konachan") {
        konachan_module.konachan_display(message);
    }

    // Display a random picture from Yandere.com
    if(command === "yandere") {
        yandere_module.yandere_display(message);
    }

    // Display a cat picture or gif on the channel
    if (command === "cat") {
        cat_module.cat_display(message);
    }

    // A bundle of functions to do some maths
    if (command === 'add') {
        math.add(args, message);
    } // Addition
    if (command === 'substract') {
        math.substract(args, message);
    } // Substraction
    if (command === 'multiply') {
        math.multiply(args, message);
    } // Multiplicaion 
    if (command === 'divide') {
        math.divide(args, message);
    } // Division

    // Allow the user to use the bot profile to send a message
    if (command === "say") {
        // Checking if the user has the right to use the bot profile
        let modRole = message.guild.roles.find("name", "chat");
        if (message.member.roles.has(modRole.id)) {
            message.channel.sendMessage(args);
        } else {
            message.reply("Chat autorisation needed");
        }
    }

    // Allows the bot to kick someone from the channel
    if (command === "kick") {
        kick_module.kick(message, bot);
    }

    // When called, the bot will present himself
    if (command === "presentation") {
        message.channel.sendMessage("This function is actually in development \"discord.js\"");
    }

    // Display all current available commands
    if (command === "help") {
        message.channel.sendMessage('```Administration :```\n');
        message.channel.sendMessage('--> !set_hello <true / false> : enable/disable greetings\n--> !set_safe <safe | questionable | explicit> -> specify the level of nudity in the pictures being posted\n--> !kick <User ID> -> kick the specified user from the channel\n--> !ban <User ID> -> The specified user get banned permanently\n');
        message.channel.sendMessage('```Math :```\n');
        message.channel.sendMessage('--> !add <number1> <number2> <number3>\n--> !substract <number1> <number2> <number3>\n--> !multiply<number1> <number2> <number3>\n--> !divide <number1> <number2> <number3>\n');
        message.channel.sendMessage('```Pictures :```\n');
        message.channel.sendMessage('--> !konachan <tag> -> Display a random image from Konachan.com\n--> !yandere <tag> -> Display a random image from Yandere.com\n---->example <blush> | <vocaloid> | <touhou> | <flower> | <neko>\n--> !cat -> Load a cat fact (picture, gif...)\n');
        message.channel.sendMessage('```Addictionnal features :```\n');
        message.channel.sendMessage('--> !say <message> -> Use the bot profile to send a message\n--> !presentation -> Quick presentation of the bot !\n');
    }

    // The user specified get banned
    if (command === "ban") {
        message.channel.sendMessage("http://www.themarysue.com/wp-content/uploads/2014/09/banhammer.jpg");
        // Send the message without quoting the user
    }

    // -> actually in test <-  allow the user to play a song from its URL on a voice channel
    if (command === "play") {
        music.play(message, args);
    }
};