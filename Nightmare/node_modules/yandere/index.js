var request = require('request');
const config = require("../../config.json");

// Pick a random picture from Yandere JSON file
module.exports.yandere_display = function (message) {
    var messageSplit = message.content.split(' ');
    var msgSearch = "";
    var searchOrig = "";
    for (var i = 1; i < messageSplit.length; i++) {
        if (i === 1) {
            searchOrig = messageSplit[i];
        } else {
            searchOrig = searchOrig + "+" + messageSplit[i];
        }
    }
    console.log(searchOrig);
    // "rating" allows to chose the obsenity level of picture s being displayed
    //  "limit" allows to chose the number of pictures being displayed for a single request (default is  100)
    msgSearch = 'order:score rating:' + config.pic_safe + " " + searchOrig;
    request.get('https://yande.re/post.json', {
        qs: {
            limit: 200,
            tags: msgSearch
        }
    }, function (error, response, body) {
        if (error) {
            message.reply('a error occured!');
        }
        if (!error && response.statusCode === 200) {
            try {
                body = JSON.parse(body);
            } catch (e) {
                console.log(e);
            }
            if (typeof (body) !== 'undefined' && body.length > 0) {
                var randome = random(0, body.length);
                randome = Math.floor(randome);
                if (typeof (body[randome]) !== 'undefined' && typeof (body[randome].file_url) !== 'undefined') {
                    message.channel.sendMessage(`${body[randome].file_url}`, function (err, message) {
                        if (err)
                            return console.log(err);
                    });
                } else {

                }
            } else {
                message.reply('nsfw-images.nothing-found');
            }
        }
    });
};

var random = function (min, max) {
    return Math.floor(Math.random() * (max - min) + min);
};